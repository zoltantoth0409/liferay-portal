definition {

	@summary = "Directly calls the JSON WS API to add a group"
	macro _addGroup {
		Variables.assertDefined(parameterList = "${groupNameMap}");

		var portalURL = JSONCompany.getPortalURL();

		var curl = '''
			${portalURL}/api/jsonws/group/add-group \
				-u test@liferay.com:test \
				-d parentGroupId=${parentGroupId} \
				-d liveGroupId=0 \
				-d nameMap=${groupNameMap} \
				-d descriptionMap=${groupDescriptionMap} \
				-d type=1 \
				-d manualMembership=true \
				-d membershipRestriction=0 \
				-d friendlyURL= \
				-d site=true \
				-d inheritContent=false \
				-d active=true
		''';

		com.liferay.poshi.runner.util.JSONCurlUtil.post("${curl}");
	}

	@summary = "Directly calls the JSON WS API to assign a user a role"
	macro _assignGroupRoleToUser {
		Variables.assertDefined(parameterList = "${groupId},${roleId},${userId}");

		var portalURL = JSONCompany.getPortalURL();

		var curl = '''
			${portalURL}/api/jsonws/usergrouprole/add-user-group-roles \
				-u test@liferay.com:test \
				-d roleId=${roleId} \
				-d groupId=${groupId} \
				-d userIds=${userId}
		''';

		com.liferay.poshi.runner.util.JSONCurlUtil.post("${curl}");
	}

	@summary = "Directly calls the JSON WS API to add a user to a group"
	macro _assignUserToGroup {
		Variables.assertDefined(parameterList = "${groupId},${userId}");

		var portalURL = JSONCompany.getPortalURL();

		var curl = '''
			${portalURL}/api/jsonws/user/add-group-users \
				-u test@liferay.com:test \
				-d groupId=${groupId} \
				-d userIds=${userId}
		''';

		com.liferay.poshi.runner.util.JSONCurlUtil.post("${curl}");
	}

	@summary = "Directly calls the JSON WS API to delete a group"
	macro _deleteGroup {
		Variables.assertDefined(parameterList = "${groupId}");

		var portalURL = JSONCompany.getPortalURL();

		var curl = '''
			${portalURL}/api/jsonws/group/delete-group \
				-u test@liferay.com:test \
				-d groupId=${groupId}
		''';

		com.liferay.poshi.runner.util.JSONCurlUtil.post("${curl}");
	}

	@summary = "Get the groupId from any existing group by using groupKey"
	macro _getGroupIdByGroupKey {
		Variables.assertDefined(parameterList = "${groupKey},${site}");

		var companyId = JSONCompany.getCompanyId();

		var parentGroupId = JSONGroupSetter.setParentGroupId(parentGroupName = "${parentGroupName}", grandParentGroupName = "${grandParentGroupName}");

		var portalURL = JSONCompany.getPortalURL();

		var curl = '''
			${portalURL}/api/jsonws/group/get-groups/company-id/${companyId}/parent-group-id/${parentGroupId}/site/${site} \
				-u test@liferay.com:test
		''';

		var groupId = JSONCurlUtil.get("${curl}", "$.[?(@['groupKey'] == '${groupKey}')]['groupId']");
		var groupId = StringUtil.replace("${groupId}", "[&quot;", "");
		var groupId = StringUtil.replace("${groupId}", "&quot;]", "");

		if ("${groupId}" == "[]") {
			fail("FAIL. Cannot find group.");
		}

		return "${groupId}";
	}

	@summary = "Get the groupId from any existing site by using groupName"
	macro _getGroupIdByName {
		Variables.assertDefined(parameterList = "${groupName}");

		var companyId = JSONCompany.getCompanyId();

		var portalURL = JSONCompany.getPortalURL();

		var curl = '''
			${portalURL}/api/jsonws/group/get-groups/company-id/${companyId}/parent-group-id/0/site/true \
				-u test@liferay.com:test
		''';

		var groupId = JSONCurlUtil.get("${curl}", "$.[?(@['nameCurrentValue'] == '${groupName}')]['groupId']");
		var groupId = StringUtil.replace("${groupId}", "[&quot;", "");
		var groupId = StringUtil.replace("${groupId}", "&quot;]", "");

		if ("${groupId}" == "[]") {
			fail("FAIL. Cannot find group.");
		}

		return "${groupId}";
	}

	@summary = "Get the groupName from any group by using groupId"
	macro _getGroupName {
		Variables.assertDefined(parameterList = "${groupId}");

		var companyId = JSONCompany.getCompanyId();

		var portalURL = JSONCompany.getPortalURL();

		var curl = '''
			${portalURL}/api/jsonws/group/get-group/group-id/${groupId} \
				-u test@liferay.com:test
		''';

		var groupName = JSONCurlUtil.get("${curl}", "$['nameCurrentValue']");

		return "${groupNam}";
	}

	@summary = "Get the parentGroupId from any existing site by using groupName"
	macro _getParentGroupIdByName {
		Variables.assertDefined(parameterList = "${groupName}");

		var companyId = JSONCompany.getCompanyId();

		var grandParentGroupId = JSONGroupSetter.setGrandParentGroupId(grandParentGroupName = "${grandParentGroupName}");

		var portalURL = JSONCompany.getPortalURL();

		var curl = '''
			${portalURL}/api/jsonws/group/get-groups/company-id/${companyId}/parent-group-id/${grandParentGroupId}/site/true \
				-u test@liferay.com:test
		''';

		var groupId = JSONCurlUtil.get("${curl}", "$.[?(@['nameCurrentValue'] == '${groupName}')]['groupId']");
		var groupId = StringUtil.replace("${groupId}", "[&quot;", "");
		var groupId = StringUtil.replace("${groupId}", "&quot;]", "");

		if ("${groupId}" == "[]") {
			fail("FAIL. Cannot find group.");
		}

		return "${groupId}";
	}

	@summary = "Get the groupId from any existing parent or child site by using groupName"
	macro _getSiteIdByGroupKey {
		Variables.assertDefined(parameterList = "${groupName}");

		var companyId = JSONCompany.getCompanyId();

		var portalURL = JSONCompany.getPortalURL();

		var curl = '''
			${portalURL}/api/jsonws/group/get-group \
				-u test@liferay.com:test \
				-d companyId=${companyId} \
				-d groupKey=${groupName}
		''';

		var groupId = JSONCurlUtil.post("${curl}", "$.[?(@['groupKey'] == '${groupName}')]['groupId']");
		var groupId = StringUtil.replace("${groupId}", "[&quot;", "");
		var groupId = StringUtil.replace("${groupId}", "&quot;]", "");

		if ("${groupId}" == "[]") {
			fail("FAIL. Cannot find group.");
		}

		return "${groupId}";
	}

}