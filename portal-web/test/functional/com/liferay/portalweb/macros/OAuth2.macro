definition {

	macro addApplication {
		LexiconEntry.gotoAdd();

		OAuth2.inputApplicationValues(
			applicationName = "${applicationName}",
			callbackURI = "${callbackURI}",
			checkboxUncheckList = "${checkboxUncheckList}",
			clientProfile = "${clientProfile}",
			description = "${description}",
			privacyPolicyURL = "${privacyPolicyURL}",
			websiteURL = "${websiteURL}");

		AssertTextEquals(
			locator1 = "Portlet#HEADER",
			value1 = "${applicationName}");
	}

	macro deleteApplication {
		LexiconEntry.gotoEntryMenuItemNoError(
			menuItem = "Delete",
			rowEntry = "${applicationName}");

		AssertConfirm.assertPartialConfirmation(value1 = "Are you sure you want to delete the application?");

		AssertElementNotPresent(
			key_tableName = "${applicationName}",
			locator1 = "OAuth2#ADMIN_TABLE_APP_NAME");
	}

	macro editApplication {
		LexiconEntry.gotoEntryMenuItem(
			menuItem = "Edit",
			rowEntry = "${applicationName}");

		var newGeneratedClientSecret = OAuth2.inputApplicationValues(
			applicationName = "${newApplicationName}",
			callbackURI = "${callbackURI}",
			checkboxCheckList = "${checkboxCheckList}",
			checkboxUncheckList = "${checkboxUncheckList}",
			clientId = "${clientId}",
			clientProfile = "${clientProfile}",
			clientSecret = "${clientSecret}",
			description = "${description}",
			generateNewSecret = "${generateNewSecret}",
			privacyPolicyURL = "${privacyPolicyURL}",
			websiteURL = "${websiteURL}"
		);

		if (isSet(newApplicationName)) {
			AssertTextEquals(
				locator1 = "Portlet#HEADER",
				value1 = "${newApplicationName}");
		}

		return "${newGeneratedClientSecret}";
	}

	macro editScopes {
		LexiconEntry.gotoEntryMenuItem(
			menuItem = "Edit",
			rowEntry = "${applicationName}");

		AssertClick(
			key_navItem = "Scopes",
			locator1 = "NavBar#NAV_ITEM_LINK",
			value1 = "Scopes");

		AssertElementPresent(
			key_navItem = "Scopes",
			locator1 = "NavBar#ACTIVE_NAV_ITEM_LINK");

		if ((isSet(checkGlobalScope)) || (isSet(uncheckGlobalScope))) {
			Navigator.gotoNavUnderline(navUnderline = "Global scopes");

			if (isSet(checkGlobalScope)) {
				Check(
					key_scopeName = "${checkGlobalScope}",
					locator1 = "OAuth2#ADMIN_GLOBAL_SCOPE_CHECKBOX");
			}

			if (isSet(uncheckGlobalScope)) {
				Uncheck(
					key_scopeName = "${uncheckGlobalScope}",
					locator1 = "OAuth2#ADMIN_GLOBAL_SCOPE_CHECKBOX");
			}
		}

		if ((isSet(resourceCheckList)) || (isSet(resourceUncheckList)) || (isSet(uncheckAllResourceScopes))) {
			if (IsElementPresent.isVisible(locator1 = "NavUnderline#NAV_UNDERLINE_LINK", key_navUnderline = "Resource scopes")) {
				Navigator.gotoNavUnderline(navUnderline = "Resource scopes");
			}

			for (var resourcePanel : list "${resourcePanels}") {
				OAuth2.expandResourcePanel(resourcePanel = "${resourcePanel}");
			}

			if (isSet(resourceCheckList)) {
				for (var scopeName : list "${resourceCheckList}") {
					Check(
						key_scopeName = "${scopeName}",
						locator1 = "OAuth2#ADMIN_RESOURCE_SCOPE_CHECKBOX");
				}
			}

			if (isSet(resourceUncheckList)) {
				for (var scopeName : list "${resourceUncheckList}") {
					Uncheck(
						key_scopeName = "${scopeName}",
						locator1 = "OAuth2#ADMIN_RESOURCE_SCOPE_CHECKBOX");
				}
			}

			if ("${uncheckAllResourceScopes}" == "true") {
				var count = "1";

				while (IsElementPresent(locator1 = "OAuth2#ADMIN_RESOURCE_SCOPE_CHECKED", key_matchCount = "${count}")) {
					Uncheck(
						key_matchCount = "${count}",
						locator1 = "OAuth2#ADMIN_RESOURCE_SCOPE_CHECKED");

					var count = ${count} + 1;
				}
			}
		}

		PortletEntry.save();

		Navigator.gotoBack();
	}

	macro expandResourcePanel {
		var key_panel = "${resourcePanel}";

		if ((IsElementPresent(locator1 = "OAuth2#ADMIN_RESOURCE_PANEL_COLLAPSED")) && (IsVisible(locator1 = "OAuth2#ADMIN_RESOURCE_PANEL_COLLAPSED"))) {
			Click(locator1 = "OAuth2#ADMIN_RESOURCE_PANEL_COLLAPSED");
		}

		AssertElementPresent(locator1 = "OAuth2#ADMIN_RESOURCE_PANEL_EXPANDED");
	}

	macro getAuthorizationCode {
		var generatedClientId = selenium.getElementValue("OAuth2#ADMIN_INPUT_FORM_CLIENT_ID");
		var portalURL = PropsUtil.get("portal.url");

		Navigator.openSpecificURL(url = "${portalURL}/o/oauth2/authorize?client_id=${generatedClientId}&response_type=code");

		Button.click(button = "Authorize");

		Pause(locator1 = "5000");

		var currentURL = selenium.getCurrentUrl();

		echo("## * Current URL: ${currentURL}");

		return "${currentURL}";

		var authorizationCode = StringUtil.extractLast("${currentURL}", "code=");

		echo("## * Authorization Code: ${authorizationCode}");

		return "${authorizationCode}";
	}

	macro inputApplicationValues {
		if (isSet(clientId)) {
			Click(locator1 = "OAuth2#ADMIN_INPUT_FORM_CLIENT_ID_EDIT_BUTTON");

			Click(locator1 = "OAuth2#ADMIN_INPUT_FORM_CLIENT_ID_EDIT_FIELD");

			Type(
				locator1 = "OAuth2#ADMIN_INPUT_FORM_CLIENT_ID_EDIT_FIELD",
				value1 = "${clientId}");

			Button.clickApply();

			if (IsElementPresent(locator1 = "Icon#CLOSE")) {
				IFrame.closeFrame();
			}
		}

		if ((isSet(clientSecret)) || (isSet(generateNewSecret))) {
			Click(locator1 = "OAuth2#ADMIN_INPUT_FORM_CLIENT_SECRET_EDIT_BUTTON");

			if ("${generateNewSecret}" == "true") {
				Click(locator1 = "OAuth2#ADMIN_INPUT_FORM_GENERATE_NEW_SECRET");

				var newGeneratedClientSecret = selenium.getElementValue("OAuth2#ADMIN_INPUT_FORM_CLIENT_SECRET_EDIT_FIELD");
			}
			else {
				Click(locator1 = "OAuth2#ADMIN_INPUT_FORM_CLIENT_SECRET_EDIT_FIELD");

				Type(
					locator1 = "OAuth2#ADMIN_INPUT_FORM_CLIENT_SECRET_EDIT_FIELD",
					value1 = "${clientSecret}");
			}

			Button.clickApply();

			if (IsElementPresent(locator1 = "Icon#CLOSE")) {
				IFrame.closeFrame();
			}
		}

		// All macros that require return must have return statement that's called.

		return "${newGeneratedClientSecret}";

		if (isSet(applicationName)) {
			PortletEntry.inputName(name = "${applicationName}");
		}

		if (isSet(websiteURL)) {
			PortletEntry.inputText(
				fieldLabel = "Website URL",
				text = "${websiteURL}");
		}

		if (isSet(description)) {
			PortletEntry.inputDescription(description = "${description}");
		}

		if (isSet(callbackURI)) {
			PortletEntry.inputTextArea(
				fieldId = "redirectURIs",
				text = "${callbackURI}");
		}

		if (isSet(privacyPolicyURL)) {
			PortletEntry.inputText(
				fieldLabel = "Privacy Policy URL",
				text = "${privacyPolicyURL}");
		}

		if (isSet(clientProfile)) {
			Select(
				key_fieldLabel = "Client Profile",
				locator1 = "Select#GENERIC_SELECT_FIELD",
				value1 = "${clientProfile}");
		}

		if (isSet(checkboxCheckList)) {
			for (var checkboxName : list "${checkboxCheckList}") {
				Check(
					key_checkboxName = "${checkboxName}",
					locator1 = "OAuth2#ADMIN_INPUT_FORM_CHECKBOX");
			}
		}

		if (isSet(checkboxUncheckList)) {
			for (var checkboxName : list "${checkboxUncheckList}") {
				Uncheck(
					key_checkboxName = "${checkboxName}",
					locator1 = "OAuth2#ADMIN_INPUT_FORM_CHECKBOX");
			}
		}

		PortletEntry.save();
	}

	macro revokeGrantedAuthViaAdmin {
		LexiconEntry.gotoEntryMenuItem(
			menuItem = "Edit",
			rowEntry = "${applicationName}");

		AssertClick(
			key_navItem = "Authorizations",
			locator1 = "NavBar#NAV_ITEM_LINK",
			value1 = "Authorizations");

		AssertElementPresent(
			key_navItem = "Authorizations",
			locator1 = "NavBar#ACTIVE_NAV_ITEM_LINK");

		AssertClickNoError(
			key_rowEntry = "${userName}",
			locator1 = "OAuth2#ADMIN_AUTHORIZATIONS_REVOKE_BUTTON",
			value1 = "Revoke");

		AssertConfirm.waitForConfirmation(value1 = "Are you sure you want to revoke the authorization?");

		Alert.viewSuccessMessage();

		AssertElementNotPresent(
			key_userName = "${userName}",
			locator1 = "OAuth2#ADMIN_AUTHORIZATIONS_USER_NAME");

		Navigator.gotoBack();
	}

	macro revokeGrantedAuthViaUser {
		ProductMenu.gotoPortlet(
			category = "My Account",
			panel = "User",
			portlet = "OAuth 2 Connected Applications");

		LexiconEntry.gotoEntryMenuItem(
			menuItem = "View",
			rowEntry = "${applicationName}");

		AssertClickNoError(
			locator1 = "OAuth2#USER_CONNECTED_APP_REMOVE_ACCESS_BUTTON",
			value1 = "Remove Access");

		AssertConfirm.waitForConfirmation(value1 = "${applicationName} will no longer have access to your account. Removed access cannot be recovered.");

		Alert.viewSuccessMessage();
	}

	macro viewApplication {
		LexiconEntry.gotoEntryMenuItem(
			menuItem = "Edit",
			rowEntry = "${applicationName}");

		if (isSet(clientId)) {
			AssertTextEquals(
				locator1 = "OAuth2#ADMIN_INPUT_FORM_CLIENT_ID",
				value1 = "${clientId}");
		}

		if (isSet(clientSecret)) {
			AssertTextEquals(
				locator1 = "OAuth2#ADMIN_INPUT_FORM_CLIENT_SECRET",
				value1 = "${clientSecret}");
		}

		if (isSet(applicationName)) {
			AssertTextEquals(
				locator1 = "TextInput#NAME",
				value1 = "${applicationName}");
		}

		if (isSet(websiteURL)) {
			AssertTextEquals(
				key_fieldLabel = "Website URL",
				locator1 = "TextInput#GENERIC_TEXT_INPUT",
				value1 = "${websiteURL}");
		}

		if (isSet(description)) {
			AssertTextEquals(
				locator1 = "TextArea#DESCRIPTION",
				value1 = "${description}");
		}

		if (isSet(privacyPolicyURL)) {
			AssertTextEquals(
				key_fieldLabel = "Privacy Policy URL",
				locator1 = "TextInput#GENERIC_TEXT_INPUT",
				value1 = "${privacyPolicyURL}");
		}

		if (isSet(callbackURI)) {
			AssertTextEquals.assertPartialText(
				key_text = "redirectURIs",
				locator1 = "TextArea#ANY",
				value1 = "${callbackURI}");
		}

		if (isSet(clientProfile)) {
			AssertSelectedLabel(
				key_fieldLabel = "Client Profile",
				locator1 = "Select#GENERIC_SELECT_FIELD",
				value1 = "${clientProfile}");
		}

		if (isSet(checkboxCheckList)) {
			for (var checkboxName : list "${checkboxCheckList}") {
				AssertChecked(
					key_checkboxName = "${checkboxName}",
					locator1 = "OAuth2#ADMIN_INPUT_FORM_CHECKBOX");
			}
		}

		Navigator.gotoBack();
	}

	macro viewApplicationInTable {
		AssertElementPresent(
			key_tableName = "${applicationName}",
			locator1 = "OAuth2#ADMIN_TABLE_APP_NAME");

		AssertTextEquals(
			key_tableName = "${applicationName}",
			locator1 = "OAuth2#ADMIN_TABLE_APP_DESCRIPTION",
			value1 = "${description}");

		AssertTextEquals(
			key_tableName = "${applicationName}",
			locator1 = "OAuth2#ADMIN_TABLE_APP_CLIENT_ID",
			value1 = "${clientId}");
	}

	macro viewGrantedAuthViaAdmin {
		LexiconEntry.gotoEntryMenuItem(
			menuItem = "Edit",
			rowEntry = "${applicationName}");

		AssertClick(
			key_navItem = "Authorizations",
			locator1 = "NavBar#NAV_ITEM_LINK",
			value1 = "Authorizations");

		AssertElementPresent(
			key_navItem = "Authorizations",
			locator1 = "NavBar#ACTIVE_NAV_ITEM_LINK");

		if ("${noAuthorizations}" == "true") {
			AssertTextEquals(
				locator1 = "Message#EMPTY_INFO",
				value1 = "No authorizations were found.");
		}
		else {
			AssertElementPresent(
				key_userName = "${userName}",
				locator1 = "OAuth2#ADMIN_AUTHORIZATIONS_USER_NAME");
		}

		Navigator.gotoBack();
	}

	macro viewGrantedAuthViaUser {
		ProductMenu.gotoPortlet(
			category = "My Account",
			panel = "User",
			portlet = "OAuth 2 Connected Applications");

		if ("${noAuthorizations}" == "true") {
			AssertTextEquals(
				locator1 = "Message#EMPTY_INFO",
				value1 = "No connected applications were found.");
		}
		else {
			AssertElementPresent(
				key_appName = "${applicationName}",
				locator1 = "OAuth2#USER_CONNECTED_APP_TABLE_NAME");

			LexiconEntry.gotoEntryMenuItem(
				menuItem = "View",
				rowEntry = "${applicationName}");

			AssertTextEquals(
				locator1 = "OAuth2#USER_CONNECTED_APP_VIEW_NAME",
				value1 = "${applicationName}");
		}
	}

	macro viewScopes {
		LexiconEntry.gotoEntryMenuItem(
			menuItem = "Edit",
			rowEntry = "${applicationName}");

		AssertClick(
			key_navItem = "Scopes",
			locator1 = "NavBar#NAV_ITEM_LINK",
			value1 = "Scopes");

		AssertElementPresent(
			key_navItem = "Scopes",
			locator1 = "NavBar#ACTIVE_NAV_ITEM_LINK");

		if ((isSet(allResourceScopesUnchecked)) || (isSet(resourceCheckedList)) || (isSet(resourceUncheckedList))) {
			if (IsElementPresent.isVisible(locator1 = "NavUnderline#NAV_UNDERLINE_LINK", key_navUnderline = "Resource scopes")) {
				Navigator.gotoNavUnderline(navUnderline = "Resource scopes");
			}

			for (var resourcePanel : list "${resourcePanels}") {
				OAuth2.expandResourcePanel(resourcePanel = "${resourcePanel}");
			}

			if (isSet(resourceCheckedList)) {
				for (var scopeName : list "${resourceCheckedList}") {
					AssertChecked(
						key_scopeName = "${scopeName}",
						locator1 = "OAuth2#ADMIN_RESOURCE_SCOPE_CHECKBOX");
				}
			}

			if (isSet(resourceUncheckedList)) {
				for (var scopeName : list "${resourceUncheckedList}") {
					AssertNotChecked(
						key_scopeName = "${scopeName}",
						locator1 = "OAuth2#ADMIN_RESOURCE_SCOPE_CHECKBOX");
				}
			}

			if ("${allResourceScopesUnchecked}" == "true") {
				AssertElementNotPresent(
					key_matchCount = "1",
					locator1 = "OAuth2#ADMIN_RESOURCE_SCOPE_CHECKED");
			}
		}

		if ((isSet(checkedGlobalScope)) || (isSet(uncheckedGlobalScope))) {
			Navigator.gotoNavUnderline(navUnderline = "Global scopes");

			if (isSet(checkedGlobalScope)) {
				AssertChecked(
					key_scopeName = "${checkedGlobalScope}",
					locator1 = "OAuth2#ADMIN_GLOBAL_SCOPE_CHECKBOX");
			}

			if (isSet(uncheckedGlobalScope)) {
				AssertNotChecked(
					key_scopeName = "${uncheckedGlobalScope}",
					locator1 = "OAuth2#ADMIN_GLOBAL_SCOPE_CHECKBOX");
			}
		}

		Navigator.gotoBack();
	}

}